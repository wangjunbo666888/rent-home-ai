<!-- 首页：顶部横幅 + 浅灰背景 + 白卡片 -->
<view class="page-index">
  <scroll-view class="main-scroll" scroll-y enhanced show-scrollbar="{{false}}">
    <!-- 未登录/未订阅引导 -->
    <view class="guide-bar need-login" wx:if="{{needLogin}}" bindtap="goLogin">
      <text>使用匹配功能需先登录</text>
      <text class="guide-link">去登录</text>
    </view>
    <view class="guide-bar need-subscribe" wx:elif="{{needSubscribe}}" bindtap="goSubscribe">
      <text>使用匹配功能需开通订阅</text>
      <text class="guide-link">去开通</text>
    </view>
    <!-- 顶部横幅区域 -->
    <view class="top-banner">
      <text class="banner-title">速配魔方</text>
      <text class="banner-desc">公寓匹配房源的智能导航</text>
      <view class="banner-bg-icon">🏢</view>
    </view>

    <view class="form-section">
      <!-- 上班地址 -->
      <view class="form-group">
        <view class="label-row">
          <text class="label-icon address">📍</text>
          <text class="label-text">上班地址</text>
          <text class="label-required">*</text>
        </view>
        <view class="input-wrap address-wrap">
          <input
            class="input address-input"
            placeholder="请输入您的办公地点"
            value="{{workAddress}}"
            bindinput="onWorkAddressInput"
            disabled="{{loading}}"
          />
          <view class="input-icon-target" wx:if="{{!suggestionLoading}}">🎯</view>
          <text class="loading-tip" wx:else>加载中...</text>
        </view>
        <text class="hint">输入后将自动联想地址，确保通勤计算精准性</text>
        <view class="suggestion-list" wx:if="{{suggestionOpen && suggestions.length > 0}}">
          <view
            class="suggestion-item"
            wx:for="{{suggestions}}"
            wx:key="index"
            data-index="{{index}}"
            bindtap="onSelectSuggestion"
          >
            <text class="suggestion-title">{{item.title || '未知'}}</text>
            <text class="suggestion-address" wx:if="{{item.address}}">{{item.address}}</text>
          </view>
        </view>
      </view>

      <!-- 最大通勤时长（滑块） -->
      <view class="form-group">
        <view class="label-row">
          <text class="label-icon commute">⏰</text>
          <text class="label-text">最大通勤时长 (分钟)</text>
        </view>
        <view class="slider-card">
          <view class="slider-head">
            <text class="slider-value">{{commuteTime}}<text class="slider-unit"> min</text></text>
            <text class="slider-desc">平均公交/地铁时长</text>
          </view>
          <slider
            class="slider"
            min="15"
            max="120"
            step="5"
            value="{{commuteTime}}"
            activeColor="#3b82f6"
            backgroundColor="#e5e7eb"
            block-size="24"
            bindchange="onCommuteSliderChange"
          />
        </view>
        <text class="hint">过滤通勤超过此时长的所有房源</text>
      </view>

      <!-- 月租预算 -->
      <view class="form-group">
        <view class="label-row">
          <text class="label-icon budget">💰</text>
          <text class="label-text">月租预算 (元)</text>
        </view>
        <view class="input-wrap budget-wrap">
          <text class="budget-prefix">¥</text>
          <input
            class="input budget-input"
            type="number"
            placeholder="请输入最高预算"
            value="{{budget}}"
            bindinput="onBudgetChange"
            disabled="{{loading}}"
          />
        </view>
        <text class="hint">系统将为您剔除价格溢出的公寓信息</text>
      </view>

      <view class="error-box" wx:if="{{error}}">⚠️ {{error}}</view>

      <button
        class="btn-match"
        disabled="{{loading || !workAddress}}"
        bindtap="onSearch"
      >
        {{loading ? '匹配中...' : '开始智能匹配'}}
      </button>
    </view>
  </scroll-view>
</view>
